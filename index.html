<!DOCTYPE html>
<html>
<head>
    <title>Weather report</title>
        <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            font-family: 'Raleway', sans-serif;
            background: #1f1d2e;
            color: #e0def4;
            position: relative;
        }

        #weatherReport {
            font-size: 24px;
            text-align: center;
        }

        #locationInfo {
            position: absolute;
            bottom: 0px;
            left: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <p id="weatherReport">Loading...</p>
    <p id="locationInfo">Detecting location...</p>

    <div id="githubLink" style="position: absolute; bottom: 10px; right: 10px;">
        <a href="https://github.com/veasman/weather-report" style="color: #ccc;">View on GitHub</a>
    </div>

    <script>
        function generateWeatherReport(weatherData) {
            const current = weatherData.current;
            const tempF = current.temp_f;
            const humidity = current.humidity;
            const windSpeedMph = current.wind_mph;
            const precipMm = current.precip_mm;
            const conditionText = current.condition.text;

            let report = "Today's weather report: It's fucking";

            if (tempF > 86) {
                report += " hot";
            } else if (tempF > 74) {
                report += " warm";
            } else if (tempF < 50) {
                report += " chilly";
            } else if (tempF < 40) {
                report += " cold";
            } else {
                report += " nice";
            }

            if (humidity > 80) {
                report += " and it's fucking humid";
            }

            if (windSpeedMph > 12) {
                report += " and it's fucking windy";
            }

            if (precipMm > 0) {
                report += " and it's fucking";

                if (conditionText.includes("rain")) {
                    report += " rainy";
                } else if (conditionText.includes("snow")) {
                    report += " snowy";
                }

                if (precipMm > .8) {
                    report += " as fuck";
                }
            }

            return report;
        }

        function updateLocationInfo(location) {
            document.getElementById("locationInfo").textContent = `Location: ${location}`;
        }

        function getLocationInfoFromCoordinates(latitude, longitude) {
            const geocodingUrl = `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`;

            fetch(geocodingUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.address) {
                        const city = data.address.city || data.address.town || data.address.village || '';
                        const state = data.address.state || '';
                        const location = `${city}, ${state}`;
                        updateLocationInfo(location);
                        fetchWeatherByLocation(city, state);
                    } else {
                        console.error("Could not determine location from coordinates.");
                        document.getElementById("weatherReport").textContent = "Unable to fetch weather data.";
                    }
                })
                .catch(error => {
                    console.error("An error occurred during reverse geocoding:", error);
                    document.getElementById("weatherReport").textContent = "Unable to fetch weather data.";
                });
        }

        function fetchWeatherByLocation(latitude, longitude) {
            const apiKey = "1e69b7049ecd4b14974140515231108";
            const weatherUrl = `https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${latitude},${longitude}&aqi=no`;

            fetch(weatherUrl)
                .then(response => response.json())
                .then(weatherData => {
                    console.log(weatherData.current);
                    const funnyReport = generateWeatherReport(weatherData);
                    document.getElementById("weatherReport").textContent = funnyReport;
                })
                .catch(error => {
                    console.error("An error occurred:", error);
                    document.getElementById("weatherReport").textContent = "Unable to fetch weather data.";
                });
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;

                        fetchWeatherByLocation(latitude, longitude);
                        updateLocationInfo(`Latitude: ${latitude}, Longitude: ${longitude}`);
                    },
                    error => {
                        console.error("Geolocation error:", error);
                        document.getElementById("weatherReport").textContent = "Unable to fetch weather data.";
                    }
                );
            } else {
                console.error("Geolocation is not supported by this browser.");
                document.getElementById("weatherReport").textContent = "Geolocation is not supported.";
            }
        }

        window.onload = getLocation;

    </script>
</body>
</html>
