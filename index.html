<!DOCTYPE html>
<html>
<head>
    <title>Weather report</title>
        <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            font-family: 'Raleway', sans-serif;
            background: #1f1d2e;
            position: relative;
        }

        #weatherReport {
            font-size: 24px;
            text-align: center;
            color: #e0def4;
        }

        #locationInfo {
            position: absolute;
            bottom: 0px;
            left: 10px;
            font-size: 14px;
            color: #e0def4;
        }
    </style>
</head>
<body>
    <p id="weatherReport">Loading...</p>
    <p id="locationInfo">Detecting location...</p>

    <div id="githubLink" style="position: absolute; bottom: 10px; right: 10px;">
        <a href="https://github.com/veasman/weather-report" style="color: #ccc;">View on GitHub</a>
    </div>

    <script>
        function generateWeatherReport(weatherData) {
            const [temp, humidity, condition, windSpeed, rain] = weatherData.split(" ");

            let report = "Today's weather report:";

            if (parseInt(temp) > 80) {
                report += " It's fucking hot";
            } else if (parseInt(temp) > 70) {
                report += " It's fucking warm";
            } else if (parseInt(temp) < 50) {
                report += " It's fucking chilly";
            } else if (parseInt(temp) < 40) {
                report += " It's fucking cold";
            } else {
                report += " It's fucking nice";
            }

            if (parseInt(humidity) > 85) {
                report += " and it's fucking humid";
            }

            if (parseInt(windSpeed) > 12) {
                report += " and it's fucking windy";
            }

            if (parseFloat(rain) > 0) {
                report += " and it's fucking";

                if (condition.includes("snow")) {
                    report += " snowy";
                }
                else if (parseFloat(rain) <= .4) {
                    report += " sprinkly";
                } else {
                    report += " rainy";
                }

                if (parseFloat(rain) > .8) {
                    report += " as fuck";
                }
            }

            return report;
        }

        function updateLocationInfo(location) {
            document.getElementById("locationInfo").textContent = `Location: ${location}`;
        }

        function getLocationInfoFromCoordinates(latitude, longitude) {
            const geocodingUrl = `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`;

            fetch(geocodingUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.address) {
                        const city = data.address.city || data.address.town || data.address.village || '';
                        const state = data.address.state || '';
                        const location = `${city}, ${state}`;
                        updateLocationInfo(location);
                        fetchWeatherByLocation(city, state);
                    } else {
                        console.error("Could not determine location from coordinates.");
                        document.getElementById("weatherReport").textContent = "Unable to fetch weather data.";
                    }
                })
                .catch(error => {
                    console.error("An error occurred during reverse geocoding:", error);
                    document.getElementById("weatherReport").textContent = "Unable to fetch weather data.";
                });
        }

        function fetchWeatherByLocation(city, state) {
            const location = `${city}, ${state}`;
            const weatherUrl = `https://wttr.in/${encodeURIComponent(location)}?format=%t+%h+%C+%w+%p`;

            fetch(weatherUrl)
                .then(response => response.text())
                .then(weatherOutput => {
                    console.log(weatherOutput);
                    const funnyReport = generateWeatherReport(weatherOutput);
                    document.getElementById("weatherReport").textContent = funnyReport;
                })
                .catch(error => {
                    console.error("An error occurred:", error);
                    document.getElementById("weatherReport").textContent = "Unable to fetch weather data.";
                });
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const latitude = position.coords.latitude;
                        const longitude = position.coords.longitude;
                        getLocationInfoFromCoordinates(latitude, longitude);
                    },
                    error => {
                        console.error("Geolocation error:", error);
                        document.getElementById("weatherReport").textContent = "Unable to fetch weather data.";
                    }
                );
            } else {
                console.error("Geolocation is not supported by this browser.");
                document.getElementById("weatherReport").textContent = "Geolocation is not supported.";
            }
        }

        window.onload = getLocation;

    </script>
</body>
</html>
